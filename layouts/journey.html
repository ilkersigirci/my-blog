{{- define "main" -}}
  {{- partial "navigation/breadcrumb.html" . -}}

  {{- /* Page header */ -}}
  <header class="mb-8">
    <div class="mb-4 flex items-center gap-3">
      {{- partial "features/icon.html" (dict "name" "user" "size" "lg" "ariaLabel" "") -}}
      <h1 class="text-foreground text-3xl font-bold">
        {{- .Title -}}
      </h1>
    </div>

    {{- with .Content -}}
      <div class="prose prose-neutral dark:prose-invert mb-6 max-w-none">
        {{- . -}}
      </div>
    {{- else -}}
      <p class="text-muted-foreground mb-6">
        My professional and academic journey through the years.
      </p>
    {{- end -}}

    {{- /* Calculate total milestones */ -}}
    {{- $journeyData := .Site.Data.journey -}}
    {{- $totalMilestones := 0 -}}
    {{- range $journeyData -}}
      {{- $totalMilestones = add $totalMilestones (len .milestones) -}}
    {{- end -}}
    
    <div class="text-muted-foreground flex items-center gap-4 text-sm">
      <div class="flex items-center gap-1">
        {{- partial "features/icon.html" (dict "name" "file-text" "size" "sm" "ariaLabel" "") -}}
        <span>{{- $totalMilestones }} milestones</span>
      </div>
      <div class="flex items-center gap-1">
        {{- partial "features/icon.html" (dict "name" "calendar" "size" "sm" "ariaLabel" "") -}}
        <span>Timeline view</span>
      </div>
    </div>
  </header>

  {{- /* Timeline content */ -}}
  <div class="relative">
    {{- /* Timeline line */ -}}
    <div class="bg-border absolute top-0 bottom-0 left-4 w-0.5"></div>

    {{- range $yearData := $journeyData -}}
      {{- $year := $yearData.year -}}
      {{- $milestones := $yearData.milestones -}}
      
      <div class="mb-12">
        {{- /* Year header with timeline marker */ -}}
        <div class="relative mb-8 flex items-center">
          <div class="bg-primary absolute left-0 z-10 flex h-8 w-8 items-center justify-center rounded-full">
            {{- partial "features/icon.html" (dict "name" "calendar" "size" "sm" "ariaLabel" "" "class" "text-primary-foreground") -}}
          </div>
          <div class="ml-12">
            <h2 class="text-foreground text-2xl font-bold">{{- $year -}}</h2>
            <p class="text-muted-foreground text-sm">
              {{- len $milestones }} milestones
            </p>
          </div>
        </div>

        {{- /* Group milestones by month */ -}}
        {{- $milestonesByMonth := dict -}}
        {{- range $milestones -}}
          {{- $month := .date | default "Unknown" -}}
          {{- $existing := index $milestonesByMonth $month | default slice -}}
          {{- $milestonesByMonth = merge $milestonesByMonth (dict $month ($existing | append .)) -}}
        {{- end -}}

        {{- /* Render each month */ -}}
        {{- $monthOrder := slice "January" "February" "March" "April" "May" "June" "July" "August" "September" "October" "November" "December" "Unknown" -}}
        {{- range $month := $monthOrder -}}
          {{- $monthMilestones := index $milestonesByMonth $month -}}
          {{- if $monthMilestones -}}
            {{- /* Month section with milestones */ -}}
            <div class="relative mb-8">
              {{- /* Month header */ -}}
              <div class="relative mb-4 flex items-center">
                <div class="bg-accent border-background absolute left-2 z-10 h-4 w-4 rounded-full border-2"></div>
                <div class="ml-12">
                  <h3 class="text-foreground text-lg font-semibold">
                    {{- if ne $month "Unknown" -}}{{- $month -}}{{- else -}}Date TBD{{- end -}}
                  </h3>
                </div>
              </div>

              {{- /* Milestone cards */ -}}
              <div class="ml-12 space-y-3">
                {{- range $monthMilestones -}}
                  {{- /* Milestone card component */ -}}
                  <article class="group bg-card border-border hover:bg-accent/50 rounded-lg border p-4 transition-all duration-300">
                    <div class="flex items-start gap-4">
                      {{- /* Milestone icon based on type */ -}}
                      <div class="flex-shrink-0 mt-1">
                        {{- if .icon -}}
                          {{- if eq .icon "graduation" -}}
                            {{- partial "features/icon.html" (dict "name" "lightbulb" "size" "sm" "ariaLabel" "" "class" "text-primary") -}}
                          {{- else if eq .icon "work" -}}
                            {{- partial "features/icon.html" (dict "name" "user" "size" "sm" "ariaLabel" "" "class" "text-blue-500") -}}
                          {{- else if eq .icon "achievement" -}}
                            {{- partial "features/icon.html" (dict "name" "heart" "size" "sm" "ariaLabel" "" "class" "text-yellow-500") -}}
                          {{- else if eq .icon "website" -}}
                            {{- partial "features/icon.html" (dict "name" "link" "size" "sm" "ariaLabel" "" "class" "text-green-500") -}}
                          {{- else -}}
                            {{- partial "features/icon.html" (dict "name" "check" "size" "sm" "ariaLabel" "" "class" "text-primary") -}}
                          {{- end -}}
                        {{- else -}}
                          {{- partial "features/icon.html" (dict "name" "check" "size" "sm" "ariaLabel" "" "class" "text-primary") -}}
                        {{- end -}}
                      </div>

                      {{- /* Content */ -}}
                      <div class="min-w-0 flex-1">
                        <h4 class="text-foreground group-hover:text-primary mb-2 font-medium transition-colors duration-200">
                          {{- .title -}}
                        </h4>

                        {{- with .description -}}
                          <p class="text-muted-foreground mb-3 text-sm">
                            {{- . -}}
                          </p>
                        {{- end -}}

                        {{- if .link -}}
                          <div class="mt-3">
                            <a href="{{- .link -}}" class="bg-primary/10 hover:bg-primary/20 text-primary border-primary/20 hover:border-primary/30 group/link inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs font-medium transition-all duration-200">
                              {{- partial "features/icon.html" (dict "name" "file-text" "size" "xs" "ariaLabel" "" "class" "group-hover/link:scale-110 transition-transform duration-200") -}}
                              <span>Read related post</span>
                              {{- partial "features/icon.html" (dict "name" "chevron-right" "size" "xs" "ariaLabel" "" "class" "group-hover/link:translate-x-0.5 transition-transform duration-200") -}}
                            </a>
                          </div>
                        {{- end -}}
                      </div>
                    </div>
                  </article>
                {{- end -}}
              </div>
            </div>
          {{- end -}}
        {{- end -}}
      </div>
    {{- end -}}
  </div>

{{- end -}}
